<!DOCTYPE html>
<html lang="id">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Login Chat Web</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 flex items-center justify-center h-screen">

  <div class="bg-white p-8 rounded-xl shadow-md w-80 text-center">
    <h1 class="text-2xl font-bold mb-6">Selamat Datang</h1>
    <button id="btn-login" class="px-4 py-2 bg-cyan-500 text-white rounded-lg font-semibold hover:bg-cyan-600">Login dengan Google</button>
  </div>

  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // Konfigurasi Firebase
    const firebaseConfig = {
      apiKey: "AIzaSyCG36zXHqQPCFNIda0s_QI6fOKszAQtZ0Y",
      authDomain: "thechat-b16c7.firebaseapp.com",
      projectId: "thechat-b16c7",
      storageBucket: "thechat-b16c7.firebasestorage.app",
      messagingSenderId: "562294284683",
      appId: "1:562294284683:web:ba118aa7de6a93a833cf8e"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const btnLogin = document.getElementById('btn-login');

    // Cek session storage / localStorage
    if (localStorage.getItem('user')) {
      // user sudah login, langsung redirect ke contacts.html
      window.location.href = 'contacts.html';
    }

    btnLogin.addEventListener('click', async () => {
      const provider = new firebase.auth.GoogleAuthProvider();
      try {
        const result = await auth.signInWithPopup(provider);
        const user = result.user;
        // Simpan info user di localStorage
        localStorage.setItem('user', JSON.stringify({
          uid: user.uid,
          displayName: user.displayName,
          photoURL: user.photoURL || ''
        }));
        // Simpan user di Firestore collection users
        await db.collection('users').doc(user.uid).set({
          uid: user.uid,
          name: user.displayName,
          photoURL: user.photoURL || ''
        });
        // Redirect ke halaman kontak
        window.location.href = 'contacts.html';
      } catch (err) {
        console.error('Login gagal:', err);
        alert('Login gagal. Coba lagi.');
      }
    });
  </script>

</body>

</html>
